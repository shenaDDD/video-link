<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ–‡ç« è®²è§£è§†é¢‘æ’­æ”¾</title>
  <style>
    :root { color-scheme: light dark; }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Microsoft Yahei", sans-serif;
      margin: 0; padding: 24px; line-height: 1.6;
    }
    .wrap{ max-width: 820px; margin: 0 auto; }
    h1{ font-size: 20px; margin: 0 0 12px; }
    .player{
      position: relative; background: #000; border-radius: 14px; overflow: hidden;
      box-shadow: 0 8px 28px rgba(0,0,0,.12);
    }
    video{ width: 100%; height: auto; display: block; }
    .meta{
      display: grid; grid-template-columns: 1fr auto; gap: 8px 16px;
      align-items: center; margin-top: 12px; font-size: 14px;
    }
    .badge{ font-variant-numeric: tabular-nums; opacity: .85; }
    .small{ font-size: 12px; opacity: .7; }
    .hint{ margin-top: 12px; font-size: 13px; opacity: .75; }
    a{ color: inherit; }
    .fail{ color: #c00; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>æ–‡ç« è®²è§£è§†é¢‘ï¼ˆå…ç™»å½•æ’­æ”¾ï¼‰</h1>
    <div class="player">
      <video id="v" controls preload="metadata" playsinline webkit-playsinline>
        <!-- è§†é¢‘æºå·²è®¾ç½®ä¸ºä½ çš„ jsDelivr é“¾æ¥ -->
        <source id="src" src="https://cdn.jsdelivr.net/gh/<ä½ çš„GitHubç”¨æˆ·å>/video-link@main/assets/æ–‡ç« è®²è§£_2.mp4" type="video/mp4">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ HTML5 è§†é¢‘æ’­æ”¾ã€‚
      </video>
    </div>

    <div class="meta">
      <div class="badge">ğŸ‘ï¸ é¡µé¢è®¿é—®ï¼š<span id="pv">â€”</span></div>
      <div class="badge">â–¶ï¸ æ’­æ”¾æ¬¡æ•°ï¼š<span id="play">â€”</span></div>
      <div class="small" id="status">æ­£åœ¨åˆå§‹åŒ–â€¦</div>
    </div>

    <p class="hint">
      è‹¥æ’­æ”¾å¡é¡¿ï¼Œè¯·ç¨ç­‰ç‰‡åˆ»è®© CDN ç¼“å­˜é¢„çƒ­ï¼Œæˆ–åˆ·æ–°é¡µé¢é‡è¯•ã€‚
    </p>
  </div>

  <script>
    // === ä½ åªéœ€æ”¹è¿™é‡Œï¼šå¡«å†™ä½ çš„ GitHub ç”¨æˆ·å ===
    const VIDEO_SRC   = "https://cdn.jsdelivr.net/gh/<ä½ çš„GitHubç”¨æˆ·å>/video-link@main/assets/æ–‡ç« è®²è§£_2.mp4";
    const COUNTAPI_NS = "video-link-viewcount-2025"; // è®¿é—®è®¡æ•°å‘½åç©ºé—´ï¼Œå¯éšæ„æ”¹å

    // â€”â€”â€” é¡µé¢é€»è¾‘ â€”â€”â€”
    const v = document.getElementById('v');
    const pvSpan = document.getElementById('pv');
    const playSpan = document.getElementById('play');
    const statusEl = document.getElementById('status');
    document.getElementById('src').src = VIDEO_SRC;

    const COUNT_BASE = "https://api.countapi.xyz";
    const PV_KEY   = "pageviews";
    const PLAY_KEY = "plays";

    function todayKey() {
      const d = new Date();
      return `pv-${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}`;
    }

    async function countapiHit(key) {
      try {
        const url = `${COUNT_BASE}/hit/${encodeURIComponent(COUNTAPI_NS)}/${encodeURIComponent(key)}`;
        const r = await fetch(url);
        if(!r.ok) throw new Error(r.status);
        return await r.json();
      } catch(e) {
        console.warn("countapi hit failed:", e);
        return null;
      }
    }

    async function countapiGet(key) {
      try {
        const url = `${COUNT_BASE}/get/${encodeURIComponent(COUNTAPI_NS)}/${encodeURIComponent(key)}`;
        const r = await fetch(url);
        if(!r.ok) throw new Error(r.status);
        return await r.json();
      } catch(e) {
        console.warn("countapi get failed:", e);
        return null;
      }
    }

    async function initCounters() {
      const k = todayKey();
      if (!localStorage.getItem(k)) {
        const res = await countapiHit(PV_KEY);
        if (res && typeof res.value === 'number') {
          pvSpan.textContent = res.value;
          localStorage.setItem(k, '1');
        }
      }
      if (pvSpan.textContent === 'â€”') {
        const g = await countapiGet(PV_KEY);
        if (g && typeof g.value === 'number') pvSpan.textContent = g.value;
      }

      let playedOnce = false;
      v.addEventListener('play', async () => {
        if (playedOnce) return;
        playedOnce = true;
        const res = await countapiHit(PLAY_KEY);
        if (res && typeof res.value === 'number') {
          playSpan.textContent = res.value;
        } else {
          const g = await countapiGet(PLAY_KEY);
          if (g && typeof g.value === 'number') playSpan.textContent = g.value;
        }
      }, { once: true });

      const g1 = await countapiGet(PV_KEY);
      if (g1 && typeof g1.value === 'number') pvSpan.textContent = g1.value;
      const g2 = await countapiGet(PLAY_KEY);
      if (g2 && typeof g2.value === 'number') playSpan.textContent = g2.value;

      statusEl.textContent = "å°±ç»ªï¼Œå¯ä»¥æ’­æ”¾ âœ…";
    }

    v.addEventListener('loadedmetadata', () => {
      statusEl.textContent = `è§†é¢‘æ—¶é•¿ï¼š${Math.round(v.duration)} ç§’`;
    });
    v.addEventListener('error', () => {
      statusEl.innerHTML = `<span class="fail">è§†é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ VIDEO_SRC åœ°å€æ˜¯å¦æ­£ç¡®ã€‚</span>`;
    });

    initCounters();
  </script>
</body>
</html>

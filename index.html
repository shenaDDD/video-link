<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ–‡ç« è®²è§£è§†é¢‘æ’­æ”¾</title>
  <style>
    :root { color-scheme: light dark; }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Microsoft Yahei", sans-serif;
      margin: 0; padding: 24px; line-height: 1.6; background: #fafafa;
    }
    .wrap{ max-width: 820px; margin: 0 auto; }
    h1{ font-size: 20px; margin: 0 0 12px; }
    .player{
      position: relative; background: #000; border-radius: 14px; overflow: hidden;
      box-shadow: 0 8px 28px rgba(0,0,0,.12);
    }
    video{ width: 100%; height: auto; display: block; background:#000; }
    .meta{
      display: grid; grid-template-columns: 1fr auto; gap: 8px 16px;
      align-items: center; margin-top: 12px; font-size: 14px;
    }
    .badge{ font-variant-numeric: tabular-nums; opacity: .85; }
    .small{ font-size: 12px; opacity: .75; }
    .hint{ margin-top: 12px; font-size: 13px; opacity: .75; }
    .fail{ color: #c00; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>æ–‡ç« è®²è§£è§†é¢‘ï¼ˆå…ç™»å½•æ’­æ”¾ï¼‰</h1>

    <div class="player">
      <video id="v" controls preload="metadata" playsinline webkit-playsinline>
        <!-- ä¼˜å…ˆä½¿ç”¨â€œURL ç¼–ç åçš„ä¸­æ–‡æ–‡ä»¶åâ€ -->
        <source id="src1" src="https://cdn.jsdelivr.net/gh/shenaDDD/video-link@main/assets/%E6%96%87%E7%AB%A0%E8%AE%B2%E8%A7%A3_2.mp4" type="video/mp4">
        <!-- å›é€€ï¼šåŸå§‹ä¸­æ–‡æ–‡ä»¶åï¼ˆéƒ¨åˆ†ç¯å¢ƒå¯ç”¨ï¼‰ -->
        <source id="src2" src="https://cdn.jsdelivr.net/gh/shenaDDD/video-link@main/assets/æ–‡ç« è®²è§£_2.mp4" type="video/mp4">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ HTML5 è§†é¢‘æ’­æ”¾ã€‚
      </video>
    </div>

    <div class="meta">
      <div class="badge">ğŸ‘ï¸ é¡µé¢è®¿é—®ï¼š<span id="pv">â€”</span></div>
      <div class="badge">â–¶ï¸ æ’­æ”¾æ¬¡æ•°ï¼š<span id="play">â€”</span></div>
      <div class="small" id="status">æ­£åœ¨åŠ è½½è§†é¢‘å…ƒæ•°æ®â€¦</div>
    </div>

    <p class="hint">
      è‹¥æ’­æ”¾å¤±è´¥ï¼Œé€šå¸¸æ˜¯è§†é¢‘ç¼–ç ä¸º H.265/HEVC å¯¼è‡´æµè§ˆå™¨ä¸æ”¯æŒã€‚å¯å°†è§†é¢‘è½¬ä¸º H.264ï¼ˆAVCï¼‰+ AAC åé‡æ–°ä¸Šä¼ ï¼›
      æˆ–æŠŠæ–‡ä»¶åæ”¹ä¸ºè‹±æ–‡ä»¥é¿å…è·¯å¾„ç¼–ç é—®é¢˜ã€‚
    </p>
  </div>

  <script>
    // ============== è®¡æ•°å‘½åç©ºé—´ï¼ˆå¯æ”¹æˆä½ å–œæ¬¢çš„å­—ç¬¦ä¸²ï¼‰ ==============
    const COUNTAPI_NS = "shenaDDD-video-link-2025";
    const COUNT_BASE  = "https://api.countapi.xyz";
    const PV_KEY = "pageviews";
    const PLAY_KEY = "plays";

    // ============== DOM ==============
    const v = document.getElementById('v');
    const pvSpan = document.getElementById('pv');
    const playSpan = document.getElementById('play');
    const statusEl = document.getElementById('status');

    // ============== çŠ¶æ€&é”™è¯¯å¤„ç† ==============
    v.addEventListener('loadedmetadata', () => {
      statusEl.textContent = `å°±ç»ªï¼Œå¯ä»¥æ’­æ”¾ âœ…ï¼ˆæ—¶é•¿ ${Math.round(v.duration)} ç§’ï¼‰`;
    });

    v.addEventListener('error', () => {
      // è‹¥å½“å‰åœ¨ç¬¬ä¸€ä¸ªæºå¤±è´¥ï¼Œå°è¯•åˆ‡åˆ°ç¬¬äºŒä¸ª
      const s1 = document.getElementById('src1');
      const s2 = document.getElementById('src2');
      if (v.currentSrc === s1.src && s2) {
        statusEl.textContent = "ä¸»æºå¤±è´¥ï¼Œæ­£åœ¨åˆ‡æ¢å¤‡ç”¨æºâ€¦";
        v.src = s2.src;
        v.load();
        v.play().catch(() => {
          statusEl.innerHTML = '<span class="fail">æ’­æ”¾å¤±è´¥ã€‚è¯·åˆ·æ–°å†è¯•ï¼Œæˆ–å°†è§†é¢‘è½¬ç ä¸º H.264 + AAC å¹¶ä½¿ç”¨è‹±æ–‡æ–‡ä»¶åã€‚</span>';
        });
      } else {
        statusEl.innerHTML = '<span class="fail">æ’­æ”¾å¤±è´¥ã€‚è¯·å°†è§†é¢‘è½¬ç ä¸º H.264ï¼ˆAVCï¼‰+ AACï¼Œæˆ–æ£€æŸ¥æ–‡ä»¶è·¯å¾„ã€‚</span>';
      }
    });

    // ============== è®¡æ•°ï¼ˆå…è´¹ã€é›¶åç«¯ï¼‰ ==============
    function todayKey() {
      const d = new Date();
      return `pv-${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}`;
    }

    async function countapi(path){
      try{
        const r = await fetch(path, { cache: 'no-store' });
        if(!r.ok) throw new Error(r.status);
        return await r.json();
      }catch(e){ return null; }
    }

    async function hit(key){
      const url = `${COUNT_BASE}/hit/${encodeURIComponent(COUNTAPI_NS)}/${encodeURIComponent(key)}`;
      return countapi(url);
    }
    async function get(key){
      const url = `${COUNT_BASE}/get/${encodeURIComponent(COUNTAPI_NS)}/${encodeURIComponent(key)}`;
      return countapi(url);
    }
    async function createIfMissing(key){
      // é¢„åˆ›å»ºï¼ˆå¹‚ç­‰ï¼‰ï¼Œé¿å…é¦–æ¬¡è®¿é—®æ— å€¼
      await countapi(`${COUNT_BASE}/create?namespace=${encodeURIComponent(COUNTAPI_NS)}&key=${encodeURIComponent(key)}&value=0`);
    }

    (async function initCounters(){
      // é¢„åˆ›å»ºä¸¤ä¸ªè®¡æ•°å™¨é”®
      await createIfMissing(PV_KEY);
      await createIfMissing(PLAY_KEY);

      // é¡µé¢è®¿é—®ï¼šæŒ‰â€œæ¯å¤©ä¸€æ¬¡/æ¯è®¾å¤‡â€å»é‡
      const dayK = todayKey();
      if (!localStorage.getItem(dayK)) {
        const res = await hit(PV_KEY);
        if (res && typeof res.value === 'number') {
          pvSpan.textContent = res.value;
          localStorage.setItem(dayK, '1');
        }
      }
      // åˆ·æ–°å±•ç¤º
      const g1 = await get(PV_KEY);
      if (g1 && typeof g1.value === 'number') pvSpan.textContent = g1.value;

      // æ’­æ”¾æ¬¡æ•°ï¼šåŒä¸€æ ‡ç­¾é¡µåªè®°ä¸€æ¬¡
      let playedOnce = false;
      v.addEventListener('play', async () => {
        if (playedOnce) return;
        playedOnce = true;
        const res = await hit(PLAY_KEY);
        if (res && typeof res.value === 'number') {
          playSpan.textContent = res.value;
        } else {
          const g = await get(PLAY_KEY);
          if (g && typeof g.value === 'number') playSpan.textContent = g.value;
        }
      }, { once: true });

      // åˆå§‹æ˜¾ç¤ºå½“å‰ç´¯è®¡æ’­æ”¾
      const g2 = await get(PLAY_KEY);
      if (g2 && typeof g2.value === 'number') playSpan.textContent = g2.value;
    })();
  </script>
</body>
</html>

<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ–‡ç« è®²è§£è§†é¢‘æ’­æ”¾</title>
  <style>
    :root { color-scheme: light dark; }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Microsoft Yahei", sans-serif;
      margin: 0; padding: 24px; line-height: 1.6; background: #fafafa;
    }
    .wrap{ max-width: 820px; margin: 0 auto; }
    h1{ font-size: 20px; margin: 0 0 12px; }
    .player{
      position: relative; background: #000; border-radius: 14px; overflow: hidden;
      box-shadow: 0 8px 28px rgba(0,0,0,.12);
    }
    video{ width: 100%; height: auto; display: block; background:#000; }
    .meta{
      display: grid; grid-template-columns: 1fr auto; gap: 8px 16px;
      align-items: center; margin-top: 12px; font-size: 14px;
    }
    .badge{ font-variant-numeric: tabular-nums; opacity: .85; }
    .small{ font-size: 12px; opacity: .75; }
    .hint{ margin-top: 12px; font-size: 13px; opacity: .75; }
    .fail{ color: #c00; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>æ–‡ç« è®²è§£è§†é¢‘ï¼ˆå…ç™»å½•æ’­æ”¾ï¼‰</h1>

    <div class="player">
      <video id="v" controls preload="metadata" playsinline webkit-playsinline>
        <!-- ä¼˜å…ˆä½¿ç”¨ URL ç¼–ç åçš„æ–‡ä»¶å -->
        <source id="src1" src="https://cdn.jsdelivr.net/gh/shenaDDD/video-link@main/%E6%96%87%E7%AB%A0%E8%AE%B2%E8%A7%A3_2.mp4" type="video/mp4">
        <!-- å›é€€ï¼šæœªç¼–ç çš„åŸå§‹è·¯å¾„ -->
        <source id="src2" src="https://cdn.jsdelivr.net/gh/shenaDDD/video-link@main/æ–‡ç« è®²è§£_2.mp4" type="video/mp4">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ HTML5 è§†é¢‘æ’­æ”¾ã€‚
      </video>
    </div>

    <div class="meta">
      <div class="badge">ğŸ‘ï¸ é¡µé¢è®¿é—®ï¼š<span id="pv">â€”</span></div>
      <div class="badge">â–¶ï¸ æ’­æ”¾æ¬¡æ•°ï¼š<span id="play">â€”</span></div>
      <div class="small" id="status">æ­£åœ¨åŠ è½½è§†é¢‘å…ƒæ•°æ®â€¦</div>
    </div>

    <p class="hint">
      è‹¥æ’­æ”¾å¤±è´¥ï¼Œé€šå¸¸æ˜¯è§†é¢‘ç¼–ç ä¸º H.265/HEVC å¯¼è‡´æµè§ˆå™¨ä¸æ”¯æŒã€‚
      å¯å°†è§†é¢‘è½¬ä¸º H.264ï¼ˆAVCï¼‰+ AAC åé‡æ–°ä¸Šä¼ ï¼Œæˆ–æŠŠæ–‡ä»¶åæ”¹ä¸ºè‹±æ–‡ã€‚
    </p>
  </div>

  <script>
    // ====== countapi å‘½åç©ºé—´ ======
    const COUNTAPI_NS = "shenaDDD-video-link-2025";
    const COUNT_BASE  = "https://api.countapi.xyz";
    const PV_KEY = "pageviews";
    const PLAY_KEY = "plays";

    // ====== DOM ======
    const v = document.getElementById('v');
    const statusEl = document.getElementById('status');
    const pvSpan = document.getElementById('pv');
    const playSpan = document.getElementById('play');

    // ====== æ’­æ”¾çŠ¶æ€ ======
    v.addEventListener('loadedmetadata', () => {
      statusEl.textContent = `å°±ç»ªï¼Œå¯ä»¥æ’­æ”¾ âœ…ï¼ˆæ—¶é•¿ ${Math.round(v.duration)} ç§’ï¼‰`;
    });

    v.addEventListener('error', () => {
      const s1 = document.getElementById('src1');
      const s2 = document.getElementById('src2');
      if (v.currentSrc === s1.src && s2) {
        statusEl.textContent = "ä¸»æºåŠ è½½å¤±è´¥ï¼Œæ­£åœ¨å°è¯•å¤‡ç”¨æºâ€¦";
        v.src = s2.src;
        v.load();
        v.play().catch(() => {
          statusEl.innerHTML = '<span class="fail">æ’­æ”¾å¤±è´¥ï¼šè¯·æ£€æŸ¥æ–‡ä»¶ç¼–ç æˆ–è·¯å¾„ã€‚</span>';
        });
      } else {
        statusEl.innerHTML = '<span class="fail">æ’­æ”¾å¤±è´¥ï¼šè§†é¢‘å¯èƒ½ä¸º H.265/HEVC ç¼–ç ï¼Œå»ºè®®è½¬ç ä¸º H.264ã€‚</span>';
      }
    });

    // ====== countapi å…è´¹ç»Ÿè®¡ ======
    async function countapi(path){
      try{
        const r = await fetch(path,{cache:'no-store'});
        if(!r.ok) throw new Error(r.status);
        return await r.json();
      }catch(e){return null;}
    }
    async function createIfMissing(key){
      await countapi(`${COUNT_BASE}/create?namespace=${encodeURIComponent(COUNTAPI_NS)}&key=${encodeURIComponent(key)}&value=0`);
    }
    async function get(key){
      return countapi(`${COUNT_BASE}/get/${encodeURIComponent(COUNTAPI_NS)}/${encodeURIComponent(key)}`);
    }
    async function hit(key){
      return countapi(`${COUNT_BASE}/hit/${encodeURIComponent(COUNTAPI_NS)}/${encodeURIComponent(key)}`);
    }
    (async function initCounters(){
      await createIfMissing(PV_KEY);
      await createIfMissing(PLAY_KEY);
      const dayK = `pv-${new Date().toISOString().slice(0,10)}`;
      if (!localStorage.getItem(dayK)) {
        const res = await hit(PV_KEY);
        if (res && typeof res.value==='number') pvSpan.textContent=res.value;
        localStorage.setItem(dayK,'1');
      }
      const g1=await get(PV_KEY);if(g1&&typeof g1.value==='number')pvSpan.textContent=g1.value;
      let playedOnce=false;
      v.addEventListener('play',async()=>{
        if(playedOnce)return;
        playedOnce=true;
        const res=await hit(PLAY_KEY);
        if(res&&typeof res.value==='number')playSpan.textContent=res.value;
        else{const g=await get(PLAY_KEY);if(g&&typeof g.value==='number')playSpan.textContent=g.value;}
      },{once:true});
      const g2=await get(PLAY_KEY);if(g2&&typeof g2.value==='number')playSpan.textContent=g2.value;
    })();
  </script>
</body>
</html>
